
kernel/%.o : kernel/%.c	
	$(CC) -c $(CFLAGS) -I./kernel/h $< -o $@

kernel/%.o : kernel/%.s
	$(AS) $(AFLAGS)  -I./kernel/h $< -o $@

kernel/%.o : kernel/%.S
	$(CC) -c $(CFLAGS) -I./kernel/h $< -o $@

KERNEL_OBJ:= 


# ----------------------------------------------------------------------------

# TODO: Conditionally include the arm/makefile.in

include kernel/arm/makefile.in
include kernel/proc/makefile.in
include kernel/utility/makefile.in
include kernel/vm/makefile.in


# ----------------------------------------------------------------------------

.PHONY:= kernel
kernel : kernel/kernel

kernel/kernel:  $(KERNEL_OBJ) kernel/arm/linker.ls 
	$(LINK) $(KERNEL_OBJ) -lgcc -T kernel/arm/linker.ls -o kernel/kernel


# ----------------------------------------------------------------------------

.PHONY : kernel/depend
kernel/depend : kernel/proc/depend \
				kernel/arm/depend \
				kernel/utility/depend \
				kernel/vm/depend

# ----------------------------------------------------------------------------

.PHONY : kernel/clean
kernel/clean : 	kernel/proc/clean \
				kernel/arm/clean \
				kernel/utility/clean \
				kernel/vm/clean 
	rm -f kernel/kernel
	rm -f kernel/dump.txt

# ----------------------------------------------------------------------------

.PHONY : kernel/dump
kernel/dump :
	$(OBJDUMP) -xshDt kernel/kernel >kernel/dump.txt

# ----------------------------------------------------------------------------

.PHONY : kernel/strip
kernel/strip :
	$(STRIP) -s --remove-section=.comment kernel/kernel

# ----------------------------------------------------------------------------


# DO NOT DELETE
